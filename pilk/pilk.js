const spritesheetJSON = {
  "frames": {
    "72_290_005":
    {
      "frame": {"x":0,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "73_290_006":
    {
      "frame": {"x":220,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "74_290_007":
    {
      "frame": {"x":440,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "75_290_008":
    {
      "frame": {"x":660,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "76_300_000":
    {
      "frame": {"x":880,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "77_300_001":
    {
      "frame": {"x":1100,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "78_300_002":
    {
      "frame": {"x":1320,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "79_300_003":
    {
      "frame": {"x":1540,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "80_300_004":
    {
      "frame": {"x":1760,"y":0,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "81_340_000":
    {
      "frame": {"x":0,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "82_340_001":
    {
      "frame": {"x":220,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "83_340_002":
    {
      "frame": {"x":440,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "84_340_003":
    {
      "frame": {"x":660,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "85_340_004":
    {
      "frame": {"x":880,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "86_340_005":
    {
      "frame": {"x":1100,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "87_340_006":
    {
      "frame": {"x":1320,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "88_340_007":
    {
      "frame": {"x":1540,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "89_340_008":
    {
      "frame": {"x":1760,"y":228,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "90_340_009":
    {
      "frame": {"x":0,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "91_400_000":
    {
      "frame": {"x":220,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "92_400_001":
    {
      "frame": {"x":440,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "93_400_002":
    {
      "frame": {"x":660,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "94_400_003":
    {
      "frame": {"x":880,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "95_400_004":
    {
      "frame": {"x":1100,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "96_400_005":
    {
      "frame": {"x":1320,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "97_400_006":
    {
      "frame": {"x":1540,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "98_400_007":
    {
      "frame": {"x":1760,"y":456,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "99_400_008":
    {
      "frame": {"x":0,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "100_400_009":
    {
      "frame": {"x":220,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "101_400_010":
    {
      "frame": {"x":440,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "102_400_011":
    {
      "frame": {"x":660,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "103_401_000":
    {
      "frame": {"x":880,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "104_401_001":
    {
      "frame": {"x":1100,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "105_401_002":
    {
      "frame": {"x":1320,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "106_401_003":
    {
      "frame": {"x":1540,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "107_401_004":
    {
      "frame": {"x":1760,"y":684,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "108_401_005":
    {
      "frame": {"x":0,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "109_401_006":
    {
      "frame": {"x":220,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "110_401_007":
    {
      "frame": {"x":440,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "111_401_008":
    {
      "frame": {"x":660,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "112_401_009":
    {
      "frame": {"x":880,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "113_401_010":
    {
      "frame": {"x":1100,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "114_401_011":
    {
      "frame": {"x":1320,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "115_402_000":
    {
      "frame": {"x":1540,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "116_402_001":
    {
      "frame": {"x":1760,"y":912,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "117_402_002":
    {
      "frame": {"x":0,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "118_402_003":
    {
      "frame": {"x":220,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "119_402_004":
    {
      "frame": {"x":440,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "120_402_005":
    {
      "frame": {"x":660,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "121_402_006":
    {
      "frame": {"x":880,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "122_402_007":
    {
      "frame": {"x":1100,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "123_402_008":
    {
      "frame": {"x":1320,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "124_402_009":
    {
      "frame": {"x":1540,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "125_402_010":
    {
      "frame": {"x":1760,"y":1140,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "126_403_000":
    {
      "frame": {"x":0,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "127_403_001":
    {
      "frame": {"x":220,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "128_403_002":
    {
      "frame": {"x":440,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "129_403_003":
    {
      "frame": {"x":660,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "130_403_004":
    {
      "frame": {"x":880,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "131_403_005":
    {
      "frame": {"x":1100,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "132_404_000":
    {
      "frame": {"x":1320,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "133_404_001":
    {
      "frame": {"x":1540,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "134_404_002":
    {
      "frame": {"x":1760,"y":1368,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "135_404_003":
    {
      "frame": {"x":0,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "136_404_004":
    {
      "frame": {"x":220,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "137_404_005":
    {
      "frame": {"x":440,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "138_404_006":
    {
      "frame": {"x":660,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "139_404_007":
    {
      "frame": {"x":880,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "140_404_008":
    {
      "frame": {"x":1100,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "141_408_000":
    {
      "frame": {"x":1320,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "142_408_001":
    {
      "frame": {"x":1540,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    },
    "143_408_002":
    {
      "frame": {"x":1760,"y":1596,"w":220,"h":228},
      "rotated": false,
      "trimmed": false,
      "spriteSourceSize": {"x":0,"y":0,"w":220,"h":228},
      "sourceSize": {"w":220,"h":228}
    }
  },
  "meta": {
    "app": "https://www.codeandweb.com/texturepacker",
    "version": "1.1",
    "image": "spritesheets/spritesheet2.png",
    "format": "RGBA8888",
    "size": {"w":1980,"h":1824},
    "scale": "1",
    "smartupdate": "$TexturePacker:SmartUpdate:7bcf70f1f5b2b9c6c682a9d11b09fcb8:13a0a5abe058334ace6a00b8d4216fe7:bc5e4c3e253241b36d5edc96e79f938b$"
  }, 
  "animations": { // TODO: animations are grouped into sets in the format {ID}_{GROUP_ID}_{ORDER_IN_GROUP}
    // TODO: automatically create groups based on format {ID}_{GROUP_ID}_{ORDER_IN_GROUP}
    walkingRight: [
      "91_400_000", "92_400_001", "93_400_002","94_400_003",
      "95_400_004", "96_400_005", "97_400_006","98_400_007",
      "99_400_008", "100_400_009", "101_400_010","102_400_011"
    ],
    walkingLeft: [
      // "103_401_000", 
      "104_401_001", "105_401_002","106_401_003",
      "107_401_004", "108_401_005", "109_401_006","110_401_007",
      "111_401_008", "112_401_009", "113_401_010","114_401_011"
    ]
  }
}
const necoArcOffset = {x : 110, y: 190}
const validMovementKeyCodes = {"87": true, "65": true, "83": true, "68": true }
const WALKING_RIGHT = 0;
const WALKING_LEFT = 1;

async function start()  {
  // Create the application helper and add its render target to the page
  let app = new PIXI.Application({ resizeTo: window });  // TODO: Investigate toResize: window
  document.body.appendChild(app.view);
  app.stage.height = 1080;
  app.stage.width = 1920;

  const spritesheet = new PIXI.Spritesheet(
    PIXI.BaseTexture.from(spritesheetJSON.meta.image), 
    spritesheetJSON
  )
  await spritesheet.parse();

  // Background
  let background = PIXI.Sprite.from('assets/necoarcjordans.jpeg')
  app.stage.addChild(background);

  // looping animated sprite for neco arc
  const anim = new PIXI.AnimatedSprite(spritesheet.animations.walkingRight);
  anim.animationSpeed = 0.1666;
  anim.play();
  let curAnimation = WALKING_RIGHT;
  // anim.eventMode = 'static';
  // anim.onglobalpointermove = (event) => {
  //   console.log(event);
  //   anim.parent.toLocal(event.global, null, anim.position)
  // }

  app.stage.addChild(anim);

  // Move neko arc closer to the app.stage
  // Change neco arc's walkingRight animation based on whether
  // the new position is to the left or to the right
  let newNecoArcPosition = null;
  app.stage.eventMode = 'static';
  app.stage.onclick = (e) => {
    newNecoArcPosition = {x: e.global.x - necoArcOffset.x, y: e.global.y - necoArcOffset.y};
  }
  // Add keyboard input
  window.addEventListener("keydown", keysDown);
  window.addEventListener("keyup", keysUp);
  let keys = {}
  function keysDown(e) { // Handle wasd input for neco arc
    keys[e.keyCode] = true;
    if (validMovementKeyCodes[e.keyCode])  {
      // switch textures on changing horizontal directory
      if (keys["65"] && !keys["68"] && curAnimation != WALKING_LEFT)  { // Pressing A and not D. Go left
        // anim.textures = anim["walkingLeft"]
        anim.textures = spritesheet.animations["walkingLeft"]
        curAnimation = WALKING_LEFT;
        anim.play()
      } 
      else if (!keys["65"] && keys["68"]  && curAnimation != WALKING_RIGHT) {
        anim.textures = spritesheet.animations["walkingRight"]
        curAnimation = WALKING_RIGHT;
        anim.play()
      }
      console.log(anim.textures)
      newNecoArcPosition = null;
    }
  }
  function keysUp(e) {  // Turn off input
    keys[e.keyCode] = false;
    // TODO: Check validMovementKeyCodes
      // Check all validMovementKeyCodes are false
      // set animation to idle
  }
  // Game loop including walkingRight animation, collision detection, etc/
  function gameLoop(delta)  { // Main game loop
    if (newNecoArcPosition != null)  {
      anim.position.set( 
        (newNecoArcPosition.x - anim.position.x) * 0.04 * delta + anim.x,
        (newNecoArcPosition.y - anim.position.y) * 0.04 * delta + anim.y 
      )
    }
    // TODO: Add velocity calculation
    if (keys["87"]) {
      anim.y -= 12 * delta;
    }
    if (keys["65"]) {
      anim.x -= 12 * delta;
    }
    if (keys["83"]) {
      anim.y += 12 * delta;
    }
    if (keys["68"]) {
      anim.x += 12 * delta;
    }
  }
  app.ticker.add(gameLoop);

}
start();